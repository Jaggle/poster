<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>POST&GET请求模拟器</title>
    <link rel="stylesheet" href="./static/bootstrap/css/bootstrap.min.css">
      <script src="static/js/jquery.min.js"></script>
    <script src="static/bootstrap/js/bootstrap.min.js"></script>
    <style>
        .wrap {
            margin-top: 10px;
        }

        .params_value {
            width: 75%;
        }

        .params_name, .params_value {
            line-height: 1.5;
            padding: 5px 10px;
        }

        .rm-param {
            margin-left: 10px;
        }

        .params_name:focus, .params_value:focus {
            outline: none;
        }

        input[type='text'] {
            border: 1px solid #ddd;
            border-radius: 2px;
        }
    </style>
</head>
<body>

<div class="container wrap">
    <h1 class="text-center">POST & GET 模拟器</h1>

    <div class="input-group">
        <span class="input-group-addon" id="basic-addon1">请求的URL</span>
        <input type="text" class="form-control" placeholder="input your link to request"
               aria-describedby="basic-addon1" name="url" value="http://192.168.0.252/aladingqa/app/qa/接口地址?ticket=123456">
    </div>
    <br>

    <table id="params_table" class="table table-bordered">
        <thead>
        <tr>
            <th width="35%">参数名</th>
            <th>参数值</th>
        </tr>
        </thead>
        <tbody id="param-body">
        <tr class="params_p" cnt="1">
            <td><input class="params_name input-text " type="text" name="p_name_1" title="参数名称" alt="参数名称" value=""
                       maxlength="100"></td>
            <td><input class="params_value input-text" type="text" name="p_value_1" title="参数数值" alt="参数数值" value=""
                       maxlength="5000">
                <button type="button" class="btn btn-default btn-sm rm-param">删除参数</button>
            </td>
        </tr>
        <tr class="params_p" cnt="2">
            <td><input class="params_name input-text " type="text" name="p_name_1" title="参数名称" alt="参数名称" value=""
                       maxlength="100"></td>
            <td><input class="params_value input-text" type="text" name="p_value_1" title="参数数值" alt="参数数值" value=""
                       maxlength="5000">
                <button type="button" class="btn btn-default btn-sm rm-param">删除参数</button>
            </td>
        </tr>
        <tr id="params_end">
            <td colspan="2">
                <button type="button" class="btn btn-default btn-sm" id="addParam">添加参数</button>
            </td>
        </tr>
        </tbody>
    </table>

    <p class="text-center">
        <button type="button" class="btn btn-success text-center">提交</button>
    </p>

    <div class="highlight">
        <pre><code>此处显示返回的数据,如果没有返回，请查看控制台</code></pre>
    </div>
    <p class="text-center" style="margin-top: 100px">Powered By Jake</p>
</div>

<script>

    //bug1 cnt的值可能会重复,应该找出最大的一个值
    //组装成对象
    //

    $(function () {
        //添加参数
        $("#addParam").click(function () {
            var length = $("tr.params_p").length;
            var max = $("tr.params_p").eq(0).attr('cnt');
            for(var i= 0;i<length;i++){
                var current_cnt =parseInt($("tr.params_p").eq(i).attr('cnt')) ;
                if(current_cnt > max){
                    max = current_cnt;
                }
            }
            max = max+1;

            $("tr.params_p").last().after('' +
                    '<tr class="params_p" cnt="' + max + '">' +
                    '<td><input class="params_name input-text " type="text" name="p_name_1" title="参数名称" alt="参数名称" value=""' +
                    ' maxlength="100"></td>' +
                    ' <td><input class="params_value input-text" type="text" name="p_value_1" title="参数数值" alt="参数数值" value=""' + 'maxlength="5000">' +
                    '<button type="button" class="btn btn-default btn-sm rm-param">删除参数</button>' +
                    '</td>' +
                    ' </tr>' +
                    '');
            //删除参数
            $(".rm-param").on('click', function () {
                $(this).parent().parent().remove();
            });
        });
        //删除参数
        $(".rm-param").on('click', function () {

            $(this).parent().parent().remove();
        });
        //发送请求
        $(".btn-success").click(function () {
            $(".highlight pre code").html("提交中...");
            var length = $("tr.params_p").length;
            var data = {};
            var key = null;
            var val = null;
            for(var i= 0;i<length;i++){
                key = $("tr.params_p").eq(i).find("input.params_name").val();
                val = $("tr.params_p").eq(i).find("input.params_value").val();
               if(key != ''){
                   eval("data."+key+"='"+val+"'");
               }
            }


            console.log(data);


            $.ajax({
                url: $("input[name='url']").val(),
                type: 'post',
                data: data,
                dataType: 'json',
                success: function (result) {
                    console.log(result);
                    $(".highlight pre code").html(JSON.stringify(result));
                },
                error: function (result, XMLHttpRequest, textStatus, errorThrown) {
                    $(".highlight pre code").html("发生错误，请查看控制台");
                    console.log('error:');
                    console.log(result);
                    console.log(XMLHttpRequest);
                    console.log("错误: " + XMLHttpRequest + ";" + textStatus + ";" + errorThrown);
                }
            });
        });
    });

</script>

</body>
</html>